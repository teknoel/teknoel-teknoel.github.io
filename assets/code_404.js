var it=Object.defineProperty;var nt=(n,t,e)=>t in n?it(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(nt(n,typeof t!="symbol"?t+"":t,e),e);const st=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}};st();const Se=["ping","call","ux","info","push","save","sync"],Ae=["call_prime","call_console","call_tune","call_warn","call_restart","call_admin","call_photo","call_gps_log"],ot=["none","default","notify","toggle_on","toggle_off","alarm","close_encounter","charge_fanfare","bonanza","guantanamera","rhythm_dancer"],at=["OK",'"index.html" served from FS'],Me=["null","sys_splash","sys_boot","sys_ap","sys_ota","sys_restart","sys_fail","reset_user","reset_admin","net_setup","net_menu","net_fail","set_bright","set_sound","tap_menu","tap_test","tap_notify","clock_static","clock_hide","clock_switch","clock_service","clock_tz","clock_dst","clock_24h","clock_pps","alarm_menu","alarm_set","alarm_notify","alarm_snooze","diag_info","diag_serial","diag_console","diag_net","diag_net_mac","diag_gps","diag_led","photo"],Be=["idle","init","begin","splash","prime","ready","run","update","wait","confirm","notify","commit","end","exit","cancel","expire","fail"],Re=["info_rc","info_user","info_mfg","info_reg","info_hardware","info_firmware","info_install","info_uptime","info_net","info_rssi","info_display","info_status","info_tap","info_ntp","info_gps","info_gps_log"],Ne=["admin_sign","admin_fpo","ota_version","ota_version_fs","ota_time","ota_time_fs","ota_fpo","mfg_product","mfg_version","mfg_date","mfg_serial","mfg_logic","mfg_display","mfg_color","mfg_note","mfg_fpo","reg_date","reg_name_1","reg_name_2","reg_user","reg_gift","reg_gp_1","reg_gp_2","reg_fpo","sys_output","sys_console","sys_fpo","def_name","def_device","def_ssid","def_pass","def_alert","def_net_fpo","def_bright","def_sound","def_av_fpo","def_tap_act","def_tap","def_tilt","def_tap_fpo","def_ntp_serve","def_ntp_int","def_ntp_fpo","def_nts_fpo","def_gps_alert","def_gps_log_i","def_gps_log_x","def_gps_fpo","def_tz","def_dst","def_24h","def_pps","def_clock_fpo","def_alarm_ind"],rt=100,Fe=["ux_boot","ux_index","ux_fpo","user_consent","user_fpo","net_name","net_device","net_ssid","net_pass","net_alert","net_fpo","ui_bright","ui_sound","ui_fpo","tap","tap_mode","tap_tilt","tap_alert","tap_fpo","ntp_server","ntp_interval","ntp_fpo","nts_fpo","gps_alert","gps_log_int","gps_log_ratio","gps_fpo","clock_static","clock_disp","clock_service","clock_tz","clock_dst","clock_24h","clock_pps","clock_fpo","alarm_tap","alarm_fpo","daily","daily_ind","daily_tone","daily_vol","daily_d","daily_h","daily_m","daily_snooze"],lt={display:0,piezo:1,xpio:2,gps:3},dt={display:1,piezo:2,xpio:4,gps:8},ct=["CLOCK_HHMM","CLOCK_DATE","CLOCK_MMSS"],ht=["NTP","GPS","pps","none"],ft={action:Se,call:Ae,ux:Me,info:Re,admin:Ne,pref:Fe,stage:Be};var m={master:ft,hwOffset:lt,hwMask:dt,actionID:Se,callID:Ae,tuneID:ot,warnID:at,uxID:Me,stageID:Be,infoID:Re,prefBase:rt,prefID:Fe,adminID:Ne,clockID:ct,serviceID:ht};const q={},J={};let A=!1;var o={...m,getPrefID:pt,controls:q,linkControl:ut,getControlByID:gt,getControlByIndex:_t,dialogs:J,linkDialog:mt,printDialogs:yt,getDialogByIndex:xt,tron:vt};function ut(n){const t=m.master[n.linkType];if(t==null){A&&console.log(`linkControl FAIL id:${n.id}, bad type:${n.linkType}`);return}const e=t.indexOf(n.id),i=n.linkType=="pref"?m.prefBase:0;return e<0?(A&&console.log(`linkControl FAIL not found id:${n.id}`),!1):(n.linkID=e+i,q[n.id]={obj:n},!0)}function gt(n){if(q.hasOwnProperty(n))return q[n].obj;A&&console.log(`map.getControlByID FAIL no table entry for ${n}`)}function _t(n,t){let e=0;switch(n){case"action":e=m.actionID[t];break;case"call":e=m.callID[t];break;case"ux":e=m.uxID[t];break;case"info":e=m.infoID[t];break;case"pref":e=m.prefID[t-m.prefBase];break;case"admin":e=m.adminID[t];break}if(e==0){A&&console.log(`map.getControlByIndex FAIL not registered ${typeID}: ${t}`);return}if(q.hasOwnProperty(e))return q[e].obj;A&&console.log(`map.getControlByIndex FAIL no object ${typeID}:${t}`)}function pt(n){let t=m.prefID.indexOf(n);if(t!=-1)return t+m.prefBase;console.warn(`getPrefID FAIL ${n} not found`)}function vt(n=!0){A=n}function mt(n){const t=m.uxID.indexOf(n.id);switch(t){case-1:return A&&console.log(`map.linkDialog FAIL id:${n.id}`),!1;default:n.linkID=t,J[n.id]={obj:n};break}return!0}function xt(n){const t=m.uxID[n];if(t==null){A&&console.log(`map.getDialogByIndex FAIL ux not registered for ${n}`);return}if(J.hasOwnProperty(t))return J[t].obj;A&&console.log(`map.getDialogByIndex FAIL no object for :${t}`)}function yt(){console.warn("printDialogs");for(const n in J)console.log(`  ${J[n].obj.id}`)}var wt={};(function(n){(function(){var t={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function e(c){return s(h(c),arguments)}function i(c,f){return e.apply(null,[c].concat(f||[]))}function s(c,f){var u=1,X=c.length,l,O="",x,v,d,te,ue,ge,_e,G;for(x=0;x<X;x++)if(typeof c[x]=="string")O+=c[x];else if(typeof c[x]=="object"){if(d=c[x],d.keys)for(l=f[u],v=0;v<d.keys.length;v++){if(l==null)throw new Error(e('[sprintf] Cannot access property "%s" of undefined value "%s"',d.keys[v],d.keys[v-1]));l=l[d.keys[v]]}else d.param_no?l=f[d.param_no]:l=f[u++];if(t.not_type.test(d.type)&&t.not_primitive.test(d.type)&&l instanceof Function&&(l=l()),t.numeric_arg.test(d.type)&&typeof l!="number"&&isNaN(l))throw new TypeError(e("[sprintf] expecting number but found %T",l));switch(t.number.test(d.type)&&(_e=l>=0),d.type){case"b":l=parseInt(l,10).toString(2);break;case"c":l=String.fromCharCode(parseInt(l,10));break;case"d":case"i":l=parseInt(l,10);break;case"j":l=JSON.stringify(l,null,d.width?parseInt(d.width):0);break;case"e":l=d.precision?parseFloat(l).toExponential(d.precision):parseFloat(l).toExponential();break;case"f":l=d.precision?parseFloat(l).toFixed(d.precision):parseFloat(l);break;case"g":l=d.precision?String(Number(l.toPrecision(d.precision))):parseFloat(l);break;case"o":l=(parseInt(l,10)>>>0).toString(8);break;case"s":l=String(l),l=d.precision?l.substring(0,d.precision):l;break;case"t":l=String(!!l),l=d.precision?l.substring(0,d.precision):l;break;case"T":l=Object.prototype.toString.call(l).slice(8,-1).toLowerCase(),l=d.precision?l.substring(0,d.precision):l;break;case"u":l=parseInt(l,10)>>>0;break;case"v":l=l.valueOf(),l=d.precision?l.substring(0,d.precision):l;break;case"x":l=(parseInt(l,10)>>>0).toString(16);break;case"X":l=(parseInt(l,10)>>>0).toString(16).toUpperCase();break}t.json.test(d.type)?O+=l:(t.number.test(d.type)&&(!_e||d.sign)?(G=_e?"+":"-",l=l.toString().replace(t.sign,"")):G="",ue=d.pad_char?d.pad_char==="0"?"0":d.pad_char.charAt(1):" ",ge=d.width-(G+l).length,te=d.width&&ge>0?ue.repeat(ge):"",O+=d.align?G+l+te:ue==="0"?G+te+l:te+G+l)}return O}var r=Object.create(null);function h(c){if(r[c])return r[c];for(var f=c,u,X=[],l=0;f;){if((u=t.text.exec(f))!==null)X.push(u[0]);else if((u=t.modulo.exec(f))!==null)X.push("%");else if((u=t.placeholder.exec(f))!==null){if(u[2]){l|=1;var O=[],x=u[2],v=[];if((v=t.key.exec(x))!==null)for(O.push(v[1]);(x=x.substring(v[0].length))!=="";)if((v=t.key_access.exec(x))!==null)O.push(v[1]);else if((v=t.index_access.exec(x))!==null)O.push(v[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");u[2]=O}else l|=2;if(l===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");X.push({placeholder:u[0],param_no:u[1],keys:u[2],sign:u[3],pad_char:u[4],align:u[5],width:u[6],precision:u[7],type:u[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");f=f.substring(u[0].length)}return r[c]=X}n.sprintf=e,n.vsprintf=i,typeof window!="undefined"&&(window.sprintf=e,window.vsprintf=i)})()})(wt);function bt(n){return new Promise(t=>{setTimeout(()=>{t()},n)})}String.prototype.camelKabob=function(){let n="";return this.split("").map(t=>{n+=t.toUpperCase()==t?`-${t.toLowerCase()}`:t}),n};String.prototype.kabobCamel=function(){return this.replace(/-./g,n=>n[1].toUpperCase())};function kt(n,t,e){if(t.value==null){console.warn(`initStorage FAIL name:${n} target:${t}`);return}const i=localStorage.getItem(n);if(i!=null)return t.value=parseFloat(i),console.log(`initStorage ${n}:${t.value} data:${parseFloat(i)}`),t.value;if(e==null)localStorage.setItem(n,Number(t.value)),console.warn(`initStorage none:${n}, target:${t.value}`),t.onDefault!=null&&t.onDefault();else return localStorage.setItem(n,Number(e)),console.warn(`initStorage none:${n}, default:${e}`),t.value=e,e}function It(n){const t=n.split(".");let e="";for(let i in t)e+=i!=1?t[i]:Number("0x"+t[1]),i<t.length-1&&(e+=".");return e}var N={delay:bt,initStorage:kt,versionString:It};Element.prototype.createDiv=function(n){const t=document.createElement("div");return t.id=n,this.appendChild(t),t};Element.prototype.createDivFirst=function(n){const t=document.createElement("div");return n!=null&&(t.id=n),this.insertAdjacentElement("afterbegin",t),t};class Z{constructor(t,e){a(this,"_id");a(this,"_tags",[]);a(this,"_valRef");a(this,"_valIO",!1);a(this,"_val");a(this,"_valLast");a(this,"_tron",!1);a(this,"_view",!1);a(this,"_height",0);a(this,"div");a(this,"data");a(this,"onChange");a(this,"onRender");switch(e=t.nodeType!=null?"div":e,e){case"object":case"obj":this.id=t;break;case"div":this.div=t,this.div.tna=this,this.id=t.id;break;case"id":default:this.div=document.getElementById(t),this.div!=null?this.div.tna=this:console.error(`tna construct no element for ${t}`),this.id=this.div==null?t:this.div.id;break}this.bRenderEnd=this.renderEnd.bind(this)}fuse(){return this.div==null?console.warn(`${this.id} fuse no div`):(this.div.classList.add("_tna"),this)}shy(t=!0){return this.div.classList.toggle("shy",t),this}prime(t=!0){if(this.div!=null)return this.div.classList.toggle("prime",t),this}touchPrime(){return this.div.ontouchstart=()=>{},this}show(){return this.render(!0),this}hide(){return this.render(!1),this}view(t=!0,e=!1){return this.render(t,e),this}viewStaged(t){return this.view(t,!0)}render(t=this._view,e=!1){this._view=t,this.div.classList.toggle("show",t),e?this.div.addEventListener("transitionend",this.bRenderEnd):this.callRender()}draw(){}renderEnd(){this.div.removeEventListener("transitionend",this.bRenderEnd),this.div.style.transition="",this.callRender()}callRender(){this.onRender!=null?this.onRender(this):this._view&&(this.onShow!=null?this.onShow(this):this.onHide!=null&&this.onHide(this))}display(t=!0){return console.log(`${this.id} display b:%o`,t),this.div.style.display=t?"":"none",this}getDiv(t,e){const i=this.div.querySelector(`#${t}`);if(i==null){console.warn(`${this.id} getDiv FAIL for "${t}"`);return}const s=e==null?this.div.id:e;return i.id=`${t}_${s}`,i}setProp(t,e){this.div.style.setProperty(t,e)}getProp(t){return getComputedStyle(this.div).getPropertyValue(t)}getPropVal(t){return parseFloat(this.getProp(t))}getDataAttr(t,e,i){const s=this.div.dataset[t],r=`--${t.camelKabob()}`,h=this.getProp(r);let c,f="";switch(e){case"pixel":f="px";case"integer":c=parseInt(s);break;case"percent":f="%";case"number":case"float":c=parseFloat(s);break;case"s":c=parseFloat(s)*1e3;break;case"string":return s==null?h.length>0?h:i:(c=s,c);default:c=parseFloat(s),s.indexOf("%")>0&&(f="%"),s.indexOf("px")>0&&(f="px");break}return isNaN(c)&&(c=parseInt(h),h.indexOf("%")>0&&(f="%"),h.indexOf("px")>0&&(f="px")),isNaN(c)&&c!=null&&(c=i),this.div.style.setProperty(r,c+f),c}parent(t,e){for(;!(t.id.indexOf(e)!=-1||t.parentElement==null);)t=t.parentElement;return t}async delay(t=1){return new Promise(e=>{setTimeout(()=>{e()},t)})}set(t){return this.data=t,t!=this._valLast&&(this.draw(),this.onChange!=null&&this.onChange(this,t),this._valLast=t),this}enable(t=!0){return this._enable=t,this}tag(...t){for(const e of t)this._tags.push(e);return this}hasTag(...t){let e=!1;for(const i of t)e=e||this._tags.find(s=>s==i);return e}latchClass(t){return this.div.querySelectorAll("._"+t).forEach(i=>i.classList.add(t)),this}set id(t){this._id=t}get id(){return this._id}valRef(t){return this._valRef=t,this}valIO(){return this._valIO=!0,this}set value(t){if(this._valIO&&this._valRef!=null&&this._valRef[0].val!=null){let e=this._valRef.findIndex(i=>i.val==t);e==-1&&(e=0,console.warn(`${this.id} set value(${t}) FAIL not in valRef, using _val:0`)),t=e}this._val=t}get value(){let t=this._val;return this._valIO&&this._valRef!=null&&this._valRef[0].val!=null&&(t=this._valRef[t].val),t}set height(t){this._height=t}get height(){return this._height}tron(t=!0){return this._tron=t,this}clamp(t,e,i){return Math.min(Math.max(t,e),i)}easeLinear(t,e,i,s){return i*t/s+e}easeInQuad(t,e,i,s){return i*(t/=s)*t+e}easeOutQuad(t,e,i,s){return-i*(t/=s)*(t-2)+e}easeInOutQuad(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e}easeInSine(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e}easeOutSine(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e}easeInOutSine(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e}easeInCubic(t,e,i,s){return i*(t/=s)*t*t+e}easeOutCubic(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e}easeInOutCubic(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e}easeOutElastic(t,e,i,s){let r,h=0,c=i;return t==0?e:(t/=s)==1?e+i:(h||(h=s*.3),c<Math.abs(i)?r=h/4:r=h/(2*Math.PI)*Math.asin(i/c),c*Math.pow(2,-10*t)*Math.sin((t*s-r)*(2*Math.PI)/h)+i+e)}}class he extends Z{constructor(e,i){super(e,i);a(this,"_enable",!1);a(this,"autoEnable",!0);a(this,"primed",!1);a(this,"synced");a(this,"linked");a(this,"linkType");a(this,"linkID");a(this,"valPush");a(this,"valSave");a(this,"lastTime");this._val=0}link(e){e!=null&&(this.linkType=e,this.linked=o.linkControl(this))}sync(e){const i=e.v;this.value=i,this.valPush=this.valSave=i,this.set(e),this.synced||(this.autoEnable&&this._enable!=null&&this.enable(),this.synced=!0)}push(){if(this.linked==!1)return;const e=this.value;e!=this.valPush&&(this.valPush=e,this.send("push",e))}save(){if(this.linked==!1)return;const e=this.value;e!=this.valSave&&(this.valSave=this.valPush=e,this.send("save",e))}send(e,i){const s={a:o.actionID.indexOf(e),t:[]};s.t.push({i:this.linkID,v:i|0}),this.linked!=null&&g.transmit(s,`${this.id} >>`)}}const Dt=`<div id="region" class="region">
    <div id="wrap" class="wrap"></div>
    <div id="label"></div>
  </div>`;class Le extends he{constructor(e,i){super(e);a(this,"_enable",!0);a(this,"_highlight",!1);a(this,"_static",!1);a(this,"_target");a(this,"_index");a(this,"_x0",0);a(this,"_y0",0);a(this,"_x1",100);a(this,"_y1",100);a(this,"_x",0);a(this,"_y",0);a(this,"_scaleX",1);a(this,"_scaleY",1);a(this,"list",[]);a(this,"onExecute");this.link(i),this.target(this.div),this.div.insertAdjacentHTML("beforeend",Dt),this.div.classList.add("tna_Icon"),this.dRegion=this.getDiv("region"),this.dWrap=this.getDiv("wrap"),this.dLabel=this.getDiv("label"),isNaN(this.getPropVal("--icon-w"))&&this.setProp("--icon-w",this.getProp("--icon-h")),this._val=0,this.label=this.getDataAttr("label","string","")}set add(e){const i=`
      <svg class="svg" viewBox="${this._x0} ${this._y0} ${this._x1} ${this._y1}">
        <g><circle cx="0" cy="0" r="50" /></g>
      </svg>`;this.dWrap.insertAdjacentHTML("beforeend",i);const s=this.dWrap.lastChild,r=s.lastElementChild;r.innerHTML=e,this.list.push(s),this.update()}set addCenter(e){this.add=e,this.list.slice(-1)[0].lastElementChild.firstElementChild.setAttribute("transform","translate(-50 -50)")}symbol(e){return window["sym_"+e]==null?console.warn(`${this.id} addSymbol FAIL: ${e}`):this.add=`<use href="#sym_${e}"/>`,this}enable(e=!0){return e==this._enable?this:(this._enable=e,this.render(),this)}render(e=this._view,i){super.render(e,i),this.div.classList.toggle("interact",e&&this._enable&&!this._static),this.div.classList.toggle("disable",!this._enable&&this._view)}set index(e){if(e=Number(e),isNaN(e))return console.warn(`${this.id} set index NaN`);if(e==this._index)return;this._index!=null&&this.list[this._index].classList.remove("show"),this.list[e].classList.add("show"),this._index=e}get index(){return this._index}def(){return this.index=0,this}toggle(e){return this._val=e==null?!this._val:e,this.draw(e),this}cycle(){let e=this._index+1;return e=e>=this.list.length?0:e,this.index=e,this.draw(),this}clear(){this.list.forEach(e=>e.remove()),this.list=[]}update(){const e=`translate(${this._x} ${this._y}) scale(${this._scaleX} ${this._scaleY})`;for(let i in this.list)this.list[i].firstElementChild.setAttribute("transform",e)}execute(){this.onExecute!=null&&this.onExecute(this),this.onChange!=null&&this.onChange(this)}set(e){typeof e!="object"&&(this.value=e),e!=this.lastVal&&(this.index=this.value),super.set(e)}svgRef(e){return e>this.list.length-1?console.warn(`${this.id} svgRef FAIL, bad index`):this.list[e]}gRef(e){return e>this.list.length-1?console.warn(`${this.id} gRef FAIL, bad index`):this.list[e].firstElementChild}viewBox(e,i,s,r){return this._x0=e,this._y0=i,this._x1=s,this._y1=r,this}translate(e,i){return this._x=e,this._y=i,this.update(),this}center(){return this.translate(50,50),this}scaleXY(e,i){return this._scaleX=e,this._scaleY=i,this.update(),this}scale(e){return this._scaleX=this._scaleY=e,this.update(),this}scaleCenter(e){return this._scaleX=this._scaleY=e,this._x=50,this._y=50,this.update(),this}sizeXY(e,i){return this.div.style.setProperty("--icon-h",i+"px"),this.div.style.setProperty("--icon-w",e+"px"),this}size(e){return this.div.style.setProperty("--icon-x",e),this}highlight(e){if(e==-1&&(e=!this._enable),!!this._enable)return this._highlight=e,this.div.classList.toggle("highlight",e),this}static(e=!0){return this._static=e,this.div.classList.toggle("interact",!e),this}set label(e){const i=e.length>0;this.dLabel.innerText=i?e:"",this.dLabel.classList.toggle("label",i)}target(e){return this._target=typeof e=="string"?window[e]:e,this._target.onclick=this.execute.bind(this),e!=this.div&&(this.div.style.pointerEvents="none"),this}enabled(){return this._enable}}class ze extends Le{constructor(e,i){super(e);a(this,"_class");a(this,"_anim");a(this,"_count",0);a(this,"_duration",0);a(this,"_delay",0);a(this,"onAnimEnd");this.link(i)}async act(e=!0){const i=this._class!=null?"act_"+this._class:"act";if(this.div.classList.contains(i)&&(this.div.classList.remove(i),await this.delay()),this.div.classList.toggle(i,e),e){const s="tna_Icon_"+(this._anim!=null?"act_"+this._anim:"act");this.div.onanimationend=r=>{`${this.id}`,r.animationName==s&&this.div.classList.remove(i),this.div.onanimationend=void 0,this.onAnimEnd!=null&&this.onAnimEnd(this)}}else this.div.onanimationend=void 0;return this}choreo(e,i){return this._anim=e,this._class=e+(i==null?"":"_"+i),this}timing(e,i=this._dur,s=0){this._count=e=Number(e),this._dur=i=Number(i),this._delay=s=Number(s);const r="--icon-act_"+this._anim;return this.setProp(r+"-n",e==0?"infinite":e),this.setProp(r+"-t",i+"ms"),this.setProp(r+"-d",s+"ms"),this}property(e,i){this.dWrap.style.setProperty("--icon-act-"+e,i)}}const Y=[];let W;function Lt(n,t){const e=window[n];if(e==null)return console.log(`panel.add() FAIL, cannot find ${n}`);e.dataset.index=Y.length,Y.push({id:n,title:t,panel:e})}function Et(){if(W!=null)return Y[W].panel}function Ot(){return W}function $t(){return W!=null?Y[W].id:void 0}function He(n,t=!1){n<0||(W=n,Y.forEach((e,i)=>{const s=e.panel,r=n==i;t||(s.classList.toggle("show",r),s.children[0].classList.toggle("show",r)),r&&s._tna_begin!=null&&s._tna_begin()}))}function Tt(n,t=!1){const e=Y.findIndex(i=>i.id==n);return e!=null&&He(e,t),e}function Ct(n){return new URLSearchParams(n).get("panel")}var se={add:Lt,current:Et,currentID:$t,currentIndex:Ot,index:He,setByID:Tt,inject:Ct};class me extends Z{constructor(e,i){super(e,"div");a(this,"_static",!1);a(this,"_index");a(this,"_label");a(this,"_html");a(this,"_target");a(this,"control");a(this,"bClick");if(i!=null){this.control=i,this.div.classList.add("menu_item"),this.dLabel=this.getDiv("label"),this.bClick=this.click.bind(this);let s=this.div.querySelector("._click");s==null&&(s=this.div),s._tna_target=this.div,this._target=s}else this.div.classList.add("menu_static"),this._target=this.div,this.static();this.enable()}click(e){let i=e.target._tna_target;i==null&&(i=this.parent(e.target,"_item")),this.execute(i),e.preventDefault(),e.stopImmediatePropagation()}async execute(e){this.control.click(this),this.div.classList.remove("hover"),this.div.classList.add("action"),await this.delay(360),this.control.view(!1),await this.delay(300),this.div.classList.remove("action"),this.control.execute(this)}enable(e=!0){return this.enabled=e,this.control!=null&&this.div.classList.toggle("hover",e&&this.control._hover),this.div.classList.toggle("enable",e),this._target.onclick=e&&!this._static?this.bClick:null,this._target.style.pointerEvents=e&&!this._static?"":"none",this}highlight(e=!0){return this.div.classList.toggle("highlight",e),this.enable(!e),this}set label(e){this.dLabel.innerText=this._label=e}get label(){return this._label}set html(e){this.dLabel.innerHTML=this._html=e}static(e=!0){return this._static=e,this._target.onclick=this.enabled&&!this._static?this.bClick:null,this._target.style.pointerEvents=e?"none":"",this}}const Pt=`<div id="region" class="region">
    <div id="bg" class="bg"></div>
    <div id="panel" class="panel"></div>
  </div>`,St=`<div>
    <div id="label" class="label"></div>
  </div>`;class At extends Z{constructor(e,i=Pt){super(e);a(this,"_enable",!1);a(this,"_index");a(this,"_highlight",!1);a(this,"_hover",!0);a(this,"_static_high",!0);a(this,"_wipe",!1);a(this,"_tm_open");a(this,"_tm_close");a(this,"_block_tm_open");a(this,"_block_tm_close");a(this,"_block_opacity");a(this,"_itemT");a(this,"_staticT");a(this,"_itemN",0);a(this,"_staticN",0);a(this,"pool",[]);a(this,"list",[]);a(this,"last");a(this,"onBegin");a(this,"onEndPrime");a(this,"onEnd");a(this,"onPrime");a(this,"onExecute");a(this,"onResize");this._itemT=St,this.div.insertAdjacentHTML("afterbegin",i),this.div.classList.add("tna_Menu"),this.dRegion=this.getDiv("region"),this.dBg=this.getDiv("bg"),this.dPanel=this.getDiv("panel"),this.getDiv("banner"),this.blocked=this.div.dataset.block!=null,this.blocked&&(this.dBlock=document.createElement("div"),this.dBlock.id="block",this.div.insertAdjacentElement("afterbegin",this.dBlock),this.getDiv("block"),this.dBlock.classList.add("block"),this.dBlock.onmousedown=this.dBlock.ontouchstart=this.escape.bind(this)),this._highlight=this.div.dataset.highlight!=null,this.enable(this.div.dataset.enable!=null),this._block_opacity=this.getProp("--menu-block-a"),this.itemH=this.getDataAttr("menuIH","pixel",""),this.staticH=this.getDataAttr("menuStaticH","pixel",""),this.merge()}merge(){let e,i;const s=this.div.childElementCount-this.blocked;for(let r=1;r<s;r++)i=this.div.children[1+this.blocked],i.classList.contains("menu_item")?(e=this.add(),e.link=i.dataset.link,e.label=i.innerHTML,i.dataset.highlight!=null&&(this._index=e._index)):i.classList.contains("menu_static")&&(e=this.add("static")),e.view(!0),i.remove();this._index!=null&&this.index(this._index),s>1&&this.update()}add(e="item"){let i,s;switch(e){case"static":if(this._staticT!=null){const r=document.createElement("template");r.innerHTML=this._staticT,s=r.content.firstElementChild.cloneNode(!0)}else s=document.createElement("div");this.last=this.createStatic(s);break;default:if(this._itemT!=null){const r=document.createElement("template");r.innerHTML=this._itemT,s=r.content.firstElementChild.cloneNode(!0)}else s=document.createElement("div");this.last=this.createItem(s);break}return i=this.dPanel.appendChild(s),this.pool.push(i),this.last}createItem(e){const i=new me(e,this),s=`${this.id}_item_${this._itemN}`;return e.id=i.id=s,i._index=this._itemN,i.link=this._itemN,i.height=this.itemH,this.list.push(e),this._itemN++,i}createStatic(e){const i=new me(e).static(),s=`${this.id}_static_${this._itemN}`;return e.id=i.id=s,i.height=this.staticH,this._staticN++,i}index(e){this._index=e;for(let i in this.pool)this.pool[i].tna.highlight(!1);return e>=0&&this.list[e].tna.highlight(),this.setStatic(e),super.set(e),this}setStatic(e){if(!this._static_high)return;let i;if(this.pool.find((s,r)=>{const h=s==this.list[e];return h&&(i=r),h}),i!=null){const s=i-1,r=i+1;s>=0&&this.pool[s].tna.highlight(),r<this.pool.length-1&&this.pool[r].tna.highlight()}}update(){let e=0;return this.pool.forEach((i,s)=>{e+=i.tna.height*i.tna._view}),this.height=e,e}clear(){this.list.forEach(e=>{e.tna=void 0,e.remove()}),this.list=[],this.pool=[],this._itemN=this._staticN=0,this.update()}click(e){this.last=e,this._wipe&&this.index(-1),this.setStatic(e._index),this.onPrime!=null&&this.onPrime(e,e.link)}execute(e){this._highlight&&(e.enable(!1),this.index(e._index)),this.onExecute!=null&&this.onExecute(this,e.link)&&this.end()}async escape(e){e!=null&&(e.stopImmediatePropagation(),e.preventDefault()),this.view(!1),this.transBlock(this._block_tm_close),this.onEnd!=null&&this.onEnd(this)}begin(){this.transRegion(this._tm_open,"ease-out"),this.transBlock(this._block_tm_open,"ease"),this.onBegin!=null&&this.onBegin(this,!0)}endPrime(){this.transRegion(this._tm_close,"ease-in"),this.onEndPrime!=null&&this.onEndPrime(this)}end(){this.transBlock(),this.onEnd!=null&&this.onEnd(this)}render(e=this._view){super.render(e),this.div.classList.toggle("open",e),e?this.begin():this.endPrime()}find(e){return this.list.find(s=>s.tna.label==e)}wipe(e=!0){return this._wipe=e,this}hover(e=!0){return this._hover=e,this}set height(e){this._height=e,this.div.style.setProperty("--menu-h",e+"px"),this.onResize!=null&&this.onResize(this)}get height(){return this._height}get count(){return Object.keys(this.list).length}get next(){if(this.last._index<this.count)return this.list[this.last._index+1]}get previous(){if(this.last._index>0)return this.list[this.last._index-1]}set template(e){this._itemT=e}set templateStatic(e){this._staticT=e}staticHigh(e=!0){return this._static_high=e,this}timing(e,i){return this._tm_open=e,this._tm_close=i,this}timingBlock(e,i){return this._block_tm_open=e,this._block_tm_close=i,this}transRegion(e=0,i=""){const s=e+"ms";return this.dRegion.style.transitionDuration=s,this.dRegion.style.transitionTimingFunction=i,this}transBlock(e=0,i=""){const s=e+"ms",r=this._view?this._block_opacity:0;return this.dBlock.style.transitionDuration=s,this.dBlock.style.transitionTimingFunction=i,this.dBlock.style.opacity=r,this.dBlock.style.visibility="visible",e==0?this.transBlockEnd():this.dBlock.ontransitionend=this.transBlockEnd.bind(this),this}transBlockEnd(){this._view||(this.dBlock.style.visibility="hidden"),this.dBlock.ontransitionend=void 0}}var Mt={control:At,item:me};const Bt=`<g stroke-width="6.7">
    <polygon
      points="89.5 72.8 50 95.6 10.5 72.8 10.5 27.2 50 4.4 89.5 27.2 89.5 72.8"
    />
    <polyline id="badge_N" points="28.4 62 28.4 38 71.6 62 71.6 38" />
  </g>`,Rt=`<div id="region" class="region">
    <div id="bg" class="bg"></div>
    <div id="banner" class="banner">
      <div class="banner_wrap">
        <div>C</div><div>u</div><div>b</div><div>e</div>
        <div>C</div><div>o</div><div>r</div><div>e</div></div></div>
    <div id="panel" class="panel"></div>
    </div>
  </div>`;const oe={},xe=[];let _,y,K,pe,je=!1,ie=!1;function Nt(){if(oe.badge=y=new ze("badge").show(),y.div.classList.add("connect"),y.add=Bt,y.value=!1,y.def(),y.ext_onExecute=t=>{t.choreo("3D_flip").timing(1,250).act(),_.view(!_._view),_._view||_.escape()},Ge(!k.prop.modeExt),oe.dot=K=new Le("badge_dot"),K.add='<circle cx="50" cy="50" r="50" />',K.static().prime().def(),K.onRender=t=>K.div.classList.toggle("orbit",t._view),window.menu!=null){oe.menu=_=new Mt.control("menu",Rt).wipe(),pe=_._index,_.timing(250,250).timingBlock(500,250),_.onExecute=(e,i)=>{e.last.index==0;const s=Xe(i);return s&&(pe=e._index),n(),s},_.onBegin=_.onEnd=e=>{y.highlight(e._view);const i=e._view?"blur(3px)":"",s=e._view?e._block_tm_open:e._block_tm_close;Te(s,"ease",i),ie=!1},$e("Admin");const t=$e("R/Con","rc");t.html='R<span style="padding-left: 2px; font-size: 130%; position: relative; top: 1.5px;">/</span>Con'}const n=async()=>{ie=!0,await N.delay(2e3),ie&&(y.highlight(!1),_.index(pe),_.transBlock(),Te(),ie=!1)}}function $e(n,t){const e=_.find(n);if(e==null){let i=_.add("static").enable();return xe.push(i),i=_.add().enable(),xe.push(i),i.label=n,i.link=`/${t!=null?t:n.toLowerCase()}/`,je=!0,i}else return e.tna}function Te(n=0,t="",e=""){const i=n+"ms",s=window.fit!=null?se.current():window.page;if(s==null)return console.warn("nav menuBG FAIL");s.style.filter=e,s.style.transitionProperty="filter",s.style.transitionDuration=`${i}`,s.style.transitionTimingFunction=t}function Xe(n){console.log(`hyper -> "${n}"`);const t=se.currentIndex(),e=new URL(n,"http://x"),i=e.pathname==document.location.pathname;if(i){const s=se.inject(e.search);se.setByID(s)}else!k.prop.local&&n.length>1&&n.slice(-1)=="/"&&(n=n.slice(0,-1)),window.location=n,_.index(t);return i}function Ft(n){!je||(xe.forEach(t=>t.view(n)),_.update())}function Ge(n=!0){y.div.classList.toggle("static",!n),y.div.classList.toggle("dim",!n),y.onExecute=n?y.ext_onExecute:void 0,y.enable(n)}var R={tna:oe,init:Nt,enable:Ge,hyper:Xe,access:Ft};class T extends he{constructor(e,i=void 0,s="info"){super(e,i);a(this,"onChange");this.link(s)}}const $={cast:"border-radius: 9px; padding: 1px 7px 0; font-style: italic; font-weight: bold",test:"border: 0.25px solid gray; border-style: solid solid solid none; border-radius: 0 9px 9px 0; padding: 1px 7px 0 0; font-style: italic; font-weight: bold",gray:"border: 0.25px solid gray; background: gray; color: white;",black:"border: 0.25px solid black; background: black; color: white;",red:"border: 0.25px solid red; background: red; color: white;",gold:"border: 0.25px solid gray; background: gold; color: black;"},B=["fail","cache","cache_end","tear","touch","normal","warn","error","alert","bold"],ye={},F={},C={};let ae,re,we=0;function zt(){ae=o.callID.indexOf("call_console"),ye.rc=new T("call_console","object","call"),ye.rc.onChange=(n,t)=>{switch(t.v){case 0:C.fail!=null?C.fail():L("fail","Access Not Authorized");break;case 1:t.n==1&&(re=0);const e=JSON.stringify(t);console.groupCollapsed("cache n:%o, count:%o",t.n,t.z.length),console.log(e),console.groupEnd(),t.z.length&&t.z.forEach(i=>{F.last_format=B[i.f],F.last_msg=i.m,L(we?B[i.f]:"tear",i.m),we++}),re+=t.z.length;break;case 2:console.warn("cache EOL chunks:%o count:%o",t.n,re),t.c!=null&&(F.capacity=t.c),t.f!=null&&(F.full=t.f),C.cache!=null&&C.cache();break;default:F.last_format=B[t.v],F.last_msg=t.x,C.msg!=null&&C.msg(),L(B[t.v],t.x);break}}}function Ht(){we=re=0}function L(n,t){if(C.output!=null)return C.output(n,t);switch(n){case"normal":console.log("%cRC",$.gray+$.cast,t);break;case"warn":const e="border: 0.25px black solid;";console.log("%cRC",e+$.gold+$.cast+e,t);break;case"error":console.log("%cRC%c %s",$.red+$.cast,"color: red",t);break;case"bold":console.log("%cRC%c %s",$.black+$.cast,"font-weight: bold",t);break}}function jt(){k.prop.preflight||Xt()}function Xt(){const n=new CustomEvent("meh"),t="rc.test format:",e={a:o.actionID.indexOf("call"),t:[{i:ae,v:B.indexOf("normal"),x:t+"normal"},{i:ae,v:B.indexOf("warn"),x:t+"warn"},{i:ae,v:B.indexOf("error"),x:t+"error"}]};n.data=JSON.stringify(e),g.parse(n)}function Gt(n){L("normal",n)}function Ut(n){L("warn",n)}function qt(n){L("error",n)}function Jt(n){L("tear",n)}function Yt(n){L("alert",n)}function Wt(n){L("bold",n)}var z={formatID:B,style:$,tna:ye,prop:F,upon:C,init:zt,prime:jt,reset:Ht,log:Gt,warn:Ut,error:qt,tear:Jt,alert:Yt,bold:Wt};const Kt=1,Vt=2;class Qt extends Z{constructor(){super("tron","object");a(this,"_enable",!0);a(this,"state",!1);a(this,"STAGE",Object.freeze({BEGIN:1,END:0}));a(this,"holdTime");a(this,"delayTime");a(this,"showTimeout");a(this,"hideTimeout");a(this,"onWrite");this.setHold().setDelay()}assign(e){const i=window[e];return i==null?console.warn("tron assign FAIL: %o",e):(i.classList.add("tna_Tron"),this.div=i,this)}enable(e=!0){if(this.div!=null&&e!=this._enable)return this.div.classList.toggle("disable",!e),this._enable=e,this}async write(e,i=this.holdTime){this.div!=null&&(clearTimeout(this.hideTimeout),this.div.innerText=e,this.div.classList.add("show","prime"),this.state=!0,this.hideTimeout=setTimeout(this.writeEnd.bind(this),i*1e3),this.onPrime!=null&&this.onWrite(this,STAGE.BEGIN))}async writeEnd(){this.state=!1,this.hideTimeout=void 0,this.div.classList.remove("show"),this.div.ontransitionend=()=>{this.div.classList.remove("prime"),this.onPrime!=null&&this.onWrite(this,STAGE.END),this.div.ontransitionend=void 0}}writeDelay(e,i=this.holdTime,s=this.delayTime){this.div!=null&&(clearTimeout(this.showTimeout),this.state?(this.div.innerText=e,this.write(e,i)):this.showTimeout=setTimeout(this.write.bind(this),s*1e3,e,i))}cancel(){clearTimeout(this.showTimeout)}kill(){this.cancel(),this.writeEnd()}add(e){return e.onTron=i=>this.write(i),this}setHold(e=Kt){return this.holdTime=e,this}setDelay(e=Vt){return this.delayTime=e,this}}var Zt=new Qt;class ei extends he{constructor(){o.prefID.indexOf("ux_index")<0&&console.warn("tna_UX constructor FAIL, cannot find prefID");super("ux_index","object");a(this,"_lastIndex");a(this,"_lastDialog");a(this,"_nextDialog");a(this,"_currentDialog");this.link("pref")}set(e){const i=e.v;if(this._lastIndex!=i&&(this._nextDialog=o.getDialogByIndex(i),this._lastDialog=o.getDialogByIndex(this._lastIndex),this._nextDialog!=null)){this.tron&&this._lastDialog!=null&&`${this._lastDialog.id}`,this._lastDialog!=null&&this.last.exit(),this._nextDialog.begin(),this._lastIndex=this._val=i,this._currentDialog=this._nextDialog,super.set(e);return}}get last(){return this._lastDialog!=null?this._lastDialog:{id:"NULL"}}get lastID(){return this._lastDialog!=null?this._lastDialog.id:void 0}get next(){return this._nextDialog}get current(){return this._currentDialog}get currentID(){return this._currentDialog!=null?this._currentDialog.id:void 0}}const ti='<div id="region" class="region"></div>',ii=`
    <svg id="svg" viewBox="0 0 12 13.8" class="digit">
      <g id="a" class="seg">
        <polygon points="9.76 0 10.03 0.31 8.66 1.5 4.33 1.5 3.31 0.34 3.7 0 9.76 0"/>
      </g>
      <g id="b" class="seg">
        <polygon points="10.63 1 9.96 5.77 9.07 6.55 8.44 5.82 8.99 1.88 10.36 0.69 10.63 1"/>
      </g>
      <g id="c" class="seg">
        <polygon points="7.57 11.97 8.13 8.03 9.02 7.25 9.65 7.98 8.97 12.8 8.58 13.14 7.57 11.97"/>
      </g>
      <g id="d" class="seg">
        <polygon points="2.86 12.3 7.19 12.3 8.21 13.46 7.82 13.8 1.76 13.8 1.49 13.49 2.86 12.3"/>
      </g>
      <g id="e" class="seg">
        <polygon points="0.89 12.8 1.56 8.03 2.45 7.25 3.08 7.98 2.53 11.92 1.16 13.11 0.89 12.8"/>
      </g>
      <g id="f" class="seg">
        <polygon points="2.5 6.55 1.87 5.82 2.55 1 2.94 0.66 3.95 1.83 3.39 5.77 2.5 6.55"/>
      </g>
      <g id="g" class="seg">
        <polygon points="8.06 6.15 8.69 6.88 7.8 7.65 3.46 7.65 2.83 6.92 3.72 6.15 8.06 6.15"/>
      </g>
      <g id="dp" class="seg"><circle cx="10.77" cy="13.05" r="0.75" /></g>
    </svg>`,ni=`<svg id="svg" viewBox="0 0 12.47 13.8" class="colon">
    <g class="seg" transform="translate(0.2 0)">
      <circle cx="1.72" cy="3.45" r="0.75" />
      <circle cx="0.75" cy="10.35" r="0.75" />
    </g>
  </svg>`;var ve={HTML:ti,DIGIT:ii,COLON:ni};class si extends he{constructor(e){super(e);a(this,"_primeD",!1);a(this,"_primeN",0);a(this,"_bright",0);a(this,"digits",[]);a(this,"onPrime");this.fuse(),this.link("info"),this.div.insertAdjacentHTML("beforeend",ve.HTML),this.div.classList.add("tna_Retro7"),this.dRegion=this.getDiv("region");for(let s=0;s<4;s++){this.dRegion.insertAdjacentHTML("beforeend",ve.DIGIT);const r=this.dRegion.querySelector("#svg");r.id=`svg_${this.digits.length}_${this.id}`,r.style.setProperty("--retro-i",s),this.digits.push(r)}this.dRegion.insertAdjacentHTML("beforeend",ve.COLON);const i=this.dRegion.querySelector("#svg");i.id=`colon_${this.id}`,this.divColon=i.children[0]}print(e){for(let i=0;i<4;i++)this.digitRaw(i,e[i])}digitRaw(e,i){let s=this.digits[e].children;for(let r=0;r<8;r++){const h=i>>r&1;s[r].classList.toggle("show",h)}}colon(e=2){this.divColon.classList.toggle("show",e==2)}clear(){this.print([0,0,0,0]),this.colon(!1),this.onChange!=null&&this.onChange(this,this._val)}async reset(){this._primeD=!1,this._primeN=0,this.view(!1),await this.delay(500),this.clear(),this.prime(!1)}async set(e){if(this._val=e.v,!this._primeD&&(this.onBegin!=null?this.onBegin(this):this.show(),this._primeN<2)){let i=0;for(let s=0;s<e.v.length;s++)i+=e.v[s];i>0&&this._primeN++,this._primeN=Math.min(this._primeN,2),this._primeN>1&&this.onPrime!=null&&this.onPrime(this)}this.print(e.v),this.colon(e.v[4]),this.onChange!=null&&this.onChange(this,e)}bright(e=0){return this._bright=e,this.div.classList.toggle("dim",e==0),this}}const Ue="3.1.04",qe={}.VITE_PREFLIGHT==="true",oi={}.VITE_EXT_SERVE==="true";qe||console.warn("core PREFLIGHT: %o",!1);const p={},w={preflight:qe,modeExt:oi,modeAP:!1,prime_local:!1},P={},V={},U={},M={};let ne,Je,b,I,de,D,be=!1;function ai(){Zt.assign("tron_output"),ci(),li(),p.title=b=new Z("head_title"),b.div.classList.add("click"),b.div.onclick=()=>{let t=V.title!=null?V.title():!1;t=t==null?!1:t,t||console.log("core title click default")},b.fuse().shy(!(w.modeExt||!de)).view(),ri(),window.diag_client.innerText=N.versionString(Ue);const n=String(document.location);w.local=n.includes("host:")||n.includes("local:"),ne=new T("developFPO","object"),ne.onDefault=()=>w.prime_local=!0,N.initStorage("develop",ne),w.develop=ne.value,p.ux=Je=new ei().tron(),R.init()}function ri(){window.socket!=null&&(D=new Le("socket").prime().show().enable(),D.symbol("x").symbol("o"),D.value=!0,D.index=1,D.onExecute=n=>{n.toggle(),n.index=n.value,g.monitor(n.value),n.value?g.init():g.kill()},p.socket_button=D)}function li(){w.modeExt||(de=window.info_display!=null,de&&(p.retro=I=new si("info_display"),I.ext_no_prime=!0,I.ext_view=void 0,I.onBegin=n=>{},I.onRender=(n,t)=>{const e=t!=null?t:n._view;n.ext_view!=e&&(n.ext_view=e,n.div.classList.toggle("click",e),n._view&&n.shy(!1))},I.div.onclick=di))}function di(){let n=V.retro!=null?V.retro():!1;n=n==null?!1:n,n||(console.log("RD click default, ux:",Je.currentID),g.send("save","clock_disp",-1))}function ci(){if(window.rc_ind==null||w.user==0)return;const n=new T("info_rc","object");z.upon.msg=(t=z.prop.last_format)=>{const e=w.user!=null?w.user:0;p.rc_ind.view(t!=z.formatID.indexOf("touch")&&e)},n.onChange=(t,e)=>{z.upon.msg(e.v)},p.rc_ind=new ze("rc_ind").symbol("dot").def(),p.rc_ind.onExecute=async t=>{t.choreo("blink","hot").timing(3,150).act(),t.onAnimEnd=()=>R.hyper("/rc/")}}let Ce=!1;async function Ee(){for(const[n,t]of Object.entries(p))t.ext_no_prime==null&&t.prime();if(de)b.shy(!1);else return Ee=!0;Ce||await N.delay(1250),b.view(!1),b.div.classList.add("slide"),window.head.classList.add("gradient"),p.retro.prime(),p.retro.shy(!1),await N.delay(250),p.retro.view(),b.shy(),b.div.classList.remove("slide"),Ce=!0,We()}function Ye(){be=!1,R.tna.badge.div.classList.add("connect","prime"),R.tna.dot.viewStaged(!1),D!=null&&(D.index=1),P.open!=null&&P.open()}async function ke(){be||(be=!0,R.tna.badge.div.classList.add("prime"),R.tna.badge.div.classList.remove("connect"),R.tna.dot.view(!0),window.head.classList.remove("gradient"),await N.delay(250),I!=null&&I.reset(),D!=null&&D.def(),P.close!=null&&P.close(),b.shy(!1),await N.delay(250),b.view())}function hi(){g.onOpen(Ye),g.onClose(ke),new T("info_install","object").onChange=(e,i)=>{e.ext_prime==null&&(U.display=(i.v&o.hwMask.display)>>o.hwOffset.display,U.piezo=(i.v&o.hwMask.piezo)>>o.hwOffset.piezo,U.xpio=(i.v&o.hwMask.xpio)>>o.hwOffset.xpio,U.gps=(i.v&o.hwMask.gps)>>o.hwOffset.gps,i.z,M.display=(i.z&o.hwMask.display)>>o.hwOffset.display,M.piezo=(i.z&o.hwMask.piezo)>>o.hwOffset.piezo,M.xpio=(i.z&o.hwMask.xpio)>>o.hwOffset.xpio,M.gps=(i.z&o.hwMask.gps)>>o.hwOffset.gps,Object.keys(M).forEach(function(s,r){M[s]||document.querySelectorAll("._"+s).forEach(c=>c.style.display="none")}))},new T("call_prime","object","call").onChange=e=>{Ee(),e.ext_prime==null&&(P.prime!=null&&P.prime(U,M),e.ext_prime=!0)},p.user=new T("info_user","object"),p.user.onChange=e=>{w.user=e.data.v,R.access(w.user),P.user!=null&&P.user(e.data)};let n=new T("call_restart","object","call");n.onChange=async e=>{z.bold("system ESP restart"),ke(),await e.delay(1e3),g.send("ping")};let t=new T("call_warn","object","call");if(t.onChange=(e,i)=>{let s=parseInt(i.v);s=s<o.warnID.length?s:-1;let r;s>=0&&(r=o.warnID[s]),r!=null&&console.error(`system warning ${r}`)},I!=null&&o.getControlByID("ui_bright")==null){const e=new T("ui_bright","object","pref");e.onChange=(i,s)=>I.bright(s.v),p[e.id]=e}}function We(n=w.user){let t=document.querySelectorAll("._admin");t.forEach(e=>e.style.display=n?"":"none"),t=document.querySelectorAll("._admin_alt"),t.forEach(e=>e.style.display=n?"none":"inherit")}var k={tna:p,prop:w,upon:P,click:V,version:Ue,install:U,activate:M,init:ai,prime:Ee,open:Ye,close:ke,patch:hi,admin:We};let ce=!1,j=!1,Ke=!1,H,Ve,Ie,De;const fi=`ws://${window.location.hostname}/ws`;let S,Q=!1;function Oe(){ce||(ce=!0,S=new WebSocket(fi),S.onopen=gi,S.onclose=_i,S.onmessage=Ve,j=!1,H=clearTimeout(H))}function ui(n){n!=Q&&(console.log(`socket monitor b:${n} state:${j}`),Q=n,n&&(!j&&H==null?Oe():H=clearTimeout(H)))}function Qe(){return j=(S!=null?S.readyState:Pe.closed)==Pe.connected,j}function gi(){console.warn("socket open"),j=!0,Ie!=null&&Ie()}function _i(){console.error(`socket close, squelch:${Ke} check:${Q}`),ce=!1,j=!1,De!=null&&De(),Q&&(clearInterval(H),H=setTimeout(Oe,1e3))}function pi(){console.warn("socket kill"),S&&S.close(),Ke=!0,ce=!1}function Ze(n){Ve=n}function vi(n){Ie=n}function mi(n){De=n}const Pe=Object.freeze({connecting:0,connected:1,closing:2,closed:3});let E=!1;var g={onOpen:vi,onClose:mi,onParse:Ze,check:Q,init:Oe,ready:Qe,monitor:ui,kill:pi,parse:fe,sendUX:Ii,sendTune:Di,sendObject:et,send:tt,fakeMessage:Ei,fakeObject:Li,transmit:ee,fill:Oi,tron:xi};Ze(fe);function xi(n=!0){E=n}function yi(n){let t;for(let e in n)t=o.getControlByIndex("info",n[e].i),t!=null?(n.length>1&&(E?console.log(`<< info #${e} %o ${n[e].v}`,t.id):t.id!="info_display"&&E&&console.log(`<< info %o ${n[e].v}`,t.id)),t.set(n[e])):E&&console.log(`parseInfo #${e} no object id %o`,o.infoID[n[e].i])}function wi(n){for(let t in n){const e=n[t].i,i=o.getControlByIndex(e<o.prefBase?"admin":"pref",e);i!=null?(E&&(n.length>1?console.log(`<< pref #${t} ${i.id} ${n[t].v}`):console.log(`<< pref ${i.id} ${n[t].v}`)),i.sync(n[t])):E&&console.log(`parseSync #${t} no object id %o`,e)}}function bi(n){for(let t in n){const e=o.getControlByIndex("call",n[t].i);e!=null&&e.set(n[t])}}function ki(n){for(let t in n){const e=n[t],i=o.getControlByIndex("ux",e.i);if(i!=null){if(e.s<0)return console.warn("parseUX FAIL bad stage value %o",o.stageID[e.v]);i.parse(e)}else E&&console.log("parsUX no object %o",o.infoID[e.i])}}function fe(n){let t=JSON.parse(n.data),e=o.actionID[t.a],i=t.t;switch(e){case"call":bi(i);break;case"ux":ki(i);break;case"info":yi(i);break;case"sync":wi(i);break}}function Ii(n,t,e){const i="ux",s=o.uxID.indexOf(n);if(s<0)return console.warn("sendUX FAIL no dialog %o",n);const r={i:s},h=o.stageID.indexOf(t);h>=0&&(r.v=h),e!=null&&(r.x=e);const c={a:o.actionID.indexOf(i),t:[r]};ee(c,`${i} >>`)}function Di(n="default"){const t="call",e=o.tuneID.indexOf(n);if(e<0)return console.warn("sendTune FAIL no melody %o",n);o.callID.indexOf("call_tune");const i={a:o.actionID.indexOf(t),t:[{i:o.callID.indexOf("call_tune"),v:e}]};ee(i,`${t} >>`)}function et(n,t,e){const i=o.actionID.indexOf(n);if(i<0)return console.log("sendObject FAIL no action %o",n);let s={a:i,t:[]},r={i:o.getPrefID(t)};return Object.assign(r,e),s.t.push(r),ee(s,`${n} >>`),s}function Li(n,t,e){const i=et(n,t,e);if(typeof i=="object"){const s=new CustomEvent("meh");s.data=JSON.stringify(i),fe(s)}}function tt(n,t,e){let i=o.actionID.indexOf(n);if(i<0){E&&console.log("send FAIL no action %o",n);return}let s={a:i,t:[]},r=-1;switch(n){case"push":case"save":case"sync":r=o.getPrefID(t);break;case"call":r=o.callID.indexOf(t);break;case"ping":r=e=0}if(r<0){E&&console.log("send FAIL no id %o in action %o",t,n);return}return s.t.push({i:r,v:e|0}),ee(s,`${n} >>`),s}function Ei(n,t,e){const i=tt(n,t,e);if(typeof i=="object"){const s=new CustomEvent("meh");s.data=JSON.stringify(i),fe(s)}}function ee(n,t){const e=JSON.stringify(n);E&&console.log(`${t} ${e}`),Qe()&&S.send(e)}async function Oi(n,t,e){let i={};try{const s=await fetch(t,{method:"GET"});if(s.status===200)i=await s.json();else throw new Error(`${t} FAIL fetch code:${s.status}`)}catch(s){console.warn(`${t} FAIL, using test data`,s),k.prop.preflight||Object.assign(i,e)}console.groupCollapsed(`comm fill ${t}`),console.log(i),console.groupEnd(),Object.assign(n,i)}const le=Math.floor(new Date().getTime()/1e3);o.actionID.indexOf("info"),o.infoID.indexOf("info_hardware"),o.infoID.indexOf("info_mfg"),o.infoID.indexOf("info_reg");const $i={a:o.actionID.indexOf("info"),t:[{i:o.infoID.indexOf("info_rc"),v:4},{i:o.infoID.indexOf("info_install"),v:o.hwMask.display+o.hwMask.piezo+o.hwMask.xpio+o.hwMask.gps+0,z:o.hwMask.display+o.hwMask.piezo+o.hwMask.xpio+o.hwMask.gps+0},{i:o.infoID.indexOf("info_user"),v:1},{i:o.infoID.indexOf("info_firmware"),v:"8.8.88"},{i:o.infoID.indexOf("info_uptime"),v:le-3600*24*99},{i:o.infoID.indexOf("info_net"),v:"expresso",p:"8C:CE:4E:D5:36:9D",q:"192.168.2.100"},{i:o.infoID.indexOf("info_rssi"),v:"-79"},{i:o.infoID.indexOf("info_status"),v:o.serviceID.indexOf("GPS"),g:1,n:1},{i:o.infoID.indexOf("info_tap"),v:4,m:884,c:4},{i:o.infoID.indexOf("info_gps"),t:le,d:1200,v:13,max:12,min:12,rec:22},{i:o.infoID.indexOf("info_ntp"),v:0,s:le,f:28,p:64,e:0,r:60*30},{i:o.infoID.indexOf("info_display"),v:[0,0,0,0,0]}]},Ti={a:o.actionID.indexOf("sync"),t:[{i:o.getPrefID("net_alert"),v:1},{i:o.getPrefID("ui_bright"),v:0,x:5},{i:o.getPrefID("ui_sound"),v:1},{i:o.getPrefID("tap_mode"),v:0},{i:o.getPrefID("tap_tilt"),v:1},{i:o.getPrefID("tap_alert"),v:0},{i:o.getPrefID("tap"),v:7,t:1023},{i:o.getPrefID("gps_alert"),v:0},{i:o.getPrefID("gps_log_int"),v:1200},{i:o.getPrefID("clock_static"),v:1},{i:o.getPrefID("clock_disp"),v:o.clockID.indexOf("CLOCK_HHMM")},{i:o.getPrefID("clock_24h"),v:0},{i:o.getPrefID("clock_tz"),v:-6},{i:o.getPrefID("clock_dst"),v:1},{i:o.getPrefID("clock_pps"),v:0},{i:o.getPrefID("daily"),v:1,h:9,m:32},{i:o.getPrefID("daily_vol"),v:1},{i:o.getPrefID("daily_ind"),v:1},{i:o.getPrefID("daily_snooze"),v:1},{i:o.getPrefID("ux_index"),v:o.uxID.indexOf("clock_static")}]};o.infoID.indexOf("info_gps_log"),le-200;const Ci={a:o.actionID.indexOf("info"),t:[{i:o.infoID.indexOf("info_display"),v:[127,127,127,127,2]}]},Pi={a:o.actionID.indexOf("info"),t:[{i:o.infoID.indexOf("info_display"),v:[120,121,109,120,0]}]},Si={a:o.actionID.indexOf("call"),t:[{i:o.callID.indexOf("call_prime"),v:0}]};function Ai(){const n=k.prop.local?500:75;setTimeout(async()=>{if(g.ready())return;k.open(),console.log("%ccomm test",z.style.test,"info + sync");const t=new CustomEvent("meh");t.data=JSON.stringify($i),g.parse(t),t.data=JSON.stringify(Ti),g.parse(t),await N.delay(75),t.data=JSON.stringify(Si),g.parse(t)},n),setTimeout(()=>{if(g.ready())return;console.log("%ccomm test",z.style.test,"display");const t=new CustomEvent("meh");t.data=JSON.stringify(Ci),g.parse(t)},n*2),setTimeout(()=>{if(g.ready())return;const t=new CustomEvent("meh");t.data=JSON.stringify(Pi),g.parse(t)},n*3)}var Mi={init:Ai};function Bi(){k.init(),k.patch(),g.monitor(k.prop.preflight),!k.prop.preflight&&(Mi.init(),window.diag_client.classList.add("show"))}k.upon.open=async()=>window.badge.classList.add("connect");window.addEventListener("load",Bi);
